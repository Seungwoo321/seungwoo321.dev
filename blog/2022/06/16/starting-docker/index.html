<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>프론트엔드 개발자의 Docker 입문기 - SEUNGWOO’S TECH LOG</title>
<meta name="description" content="트레이딩 봇 애플리케이션 구동에 필요한 복잡하고 번거로운 설정 과정을 자동화하기 위한 힌트를 얻기 위해서 깃허브의 Topics에 trading bot을 검색해 보니 깃허브 스타(Star) 수가 1k 이상인 프로젝트들은 대부분 도커(Docker)와 관련된 설정이 포함되어 있는 것을 알 수 있었습니다. 그래서 도커를 시작하게 되었고 우분투 컨테이너(Container)에 봇 애플리케이션 구동 환경을 구성하면서 겪은 문제들과 최종적으로 도커를 프로젝트에 적용해서 배포까지해 본 과정을 정리했습니다.">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="SEUNGWOO'S TECH LOG">
<meta property="og:title" content="프론트엔드 개발자의 Docker 입문기">
<meta property="og:url" content="/blog/2022/06/16/starting-docker/">


  <meta property="og:description" content="트레이딩 봇 애플리케이션 구동에 필요한 복잡하고 번거로운 설정 과정을 자동화하기 위한 힌트를 얻기 위해서 깃허브의 Topics에 trading bot을 검색해 보니 깃허브 스타(Star) 수가 1k 이상인 프로젝트들은 대부분 도커(Docker)와 관련된 설정이 포함되어 있는 것을 알 수 있었습니다. 그래서 도커를 시작하게 되었고 우분투 컨테이너(Container)에 봇 애플리케이션 구동 환경을 구성하면서 겪은 문제들과 최종적으로 도커를 프로젝트에 적용해서 배포까지해 본 과정을 정리했습니다.">



  <meta property="og:image" content="/assets/images/template.png">





  <meta property="article:published_time" content="2022-06-16T00:00:00+09:00">






<link rel="canonical" href="/blog/2022/06/16/starting-docker/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": null,
      "url": "/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="SEUNGWOO'S TECH LOG Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <link rel="apple-touch-icon" sizes="76x76" href="/assets/favicons/apple-touch-icon.png" />
<link
  rel="icon"
  type="image/png"
  sizes="32x32"
  href="/assets/favicons/favicon-32x32.png"
/>
<link
  rel="icon"
  type="image/png"
  sizes="16x16"
  href="/assets/favicons/favicon-16x16.png"
/>
<meta
  name="google-site-verification"
  content="px1TntEZ-EKoV9k9xHvbO7KsQMLwj_Ajab5nprTM_pM"
/>
<link rel="alternate" type="application/rss+xml" href="/feed.xml" />
<script
  async
  src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7701657858733816"
  crossOrigin="anonymous"
></script>
  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          SEUNGWOO'S TECH LOG
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/">Home</a>
            </li><li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li><li class="masthead__menu-item">
              <a href="https://github.com/Seungwoo321">GitHub</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/logo.png" alt="" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name"></h3>
    
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Seoul</span>
        </li>
      

      

      

      
        <li>
          <a href="mailto:seungwoo321@gmail.com">
            <meta itemprop="email" content="seungwoo321@gmail.com" />
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span>
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      
        <li>
          <a href="https://github.com/Seungwoo321" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span>
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
        
          <span class="nav__sub-title">Category</span>
        

        
        <ul>
          
            <li><a href="/categories/web">Web</a></li>
          
            <li><a href="/categories/javascript">JavaScript</a></li>
          
            <li><a href="/categories/nodejs">NodeJS</a></li>
          
            <li><a href="/categories/css">CSS</a></li>
          
            <li><a href="/categories/vue">Vue</a></li>
          
            <li><a href="/categories/aws">AWS</a></li>
          
            <li><a href="/categories/linux">Linux</a></li>
          
            <li><a href="/categories/ps">PS</a></li>
          
            <li><a href="/categories/git">Git</a></li>
          
            <li><a href="/categories/Quant">Quant</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Project</span>
        

        
        <ul>
          
            <li><a href="/vue-pivottable">VuePivottable</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>

    
  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="프론트엔드 개발자의 Docker 입문기">
    <meta itemprop="description" content="트레이딩 봇 애플리케이션 구동에 필요한 복잡하고 번거로운 설정 과정을 자동화하기 위한 힌트를 얻기 위해서 깃허브의 Topics에 trading bot을 검색해 보니 깃허브 스타(Star) 수가 1k 이상인 프로젝트들은 대부분 도커(Docker)와 관련된 설정이 포함되어 있는 것을 알 수 있었습니다.그래서 도커를 시작하게 되었고 우분투 컨테이너(Container)에 봇 애플리케이션 구동 환경을 구성하면서 겪은 문제들과 최종적으로 도커를 프로젝트에 적용해서 배포까지해 본 과정을 정리했습니다.">
    <meta itemprop="datePublished" content="2022-06-16T00:00:00+09:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">프론트엔드 개발자의 Docker 입문기
</h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2022-06-16T00:00:00+09:00">June 16, 2022</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          9 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu"><li><a href="#개발-환경">개발 환경</a></li><li><a href="#하나의-컨테이너에-구성">하나의 컨테이너에 구성</a><ul><li><a href="#ubunut-2110-컨테이너-실행">ubunut 21.10 컨테이너 실행</a></li><li><a href="#mariadb-105-설치">mariadb 10.5 설치</a></li><li><a href="#influxdb-22-설치">InfluxDB 2.2 설치</a></li><li><a href="#nodejs">Node.js</a></li><li><a href="#컨테이너-커밋">컨테이너 커밋</a></li></ul></li><li><a href="#서비스-설정-및-테스트">서비스 설정 및 테스트</a><ul><li><a href="#influxdb-22-초기-설정">InfluxDB 2.2 초기 설정</a></li><li><a href="#mariadb-105-데이터베이스-생성">mariadb 10.5 데이터베이스 생성</a></li><li><a href="#호스트pc에서-컨테이너의-mariadb-105로-로컬호스트-접속-에러-1">호스트PC에서 컨테이너의 mariadb 10.5로 로컬호스트 접속 에러 (1)</a></li><li><a href="#호스트pc에서-컨테이너의-mariadb-105로-로컬호스트-접속-에러-2">호스트PC에서 컨테이너의 mariadb 10.5로 로컬호스트 접속 에러 (2)</a></li></ul></li><li><a href="#dockerfile로-구성">Dockerfile로 구성</a><ul><li><a href="#도커파일-작성">도커파일 작성</a><ul><li><a href="#dockerfilemariadb">Dockerfile.mariadb</a></li><li><a href="#dockerfileinlfuxdb">Dockerfile.inlfuxdb</a></li></ul></li><li><a href="#도커파일-빌드하기">도커파일 빌드하기</a><ul><li><a href="#컨텍스트를-깃허브-링크로-지정시-이슈-정리">컨텍스트를 깃허브 링크로 지정시 이슈 정리</a></li></ul></li><li><a href="#이미지-배포">이미지 배포</a></li><li><a href="#컨테이너-실행">컨테이너 실행</a></li><li><a href="#run-mariadb">Run Mariadb</a></li><li><a href="#run-influxdb">Run Influxdb</a></li></ul></li><li><a href="#docker-compose로-구성">Docker Compose로 구성</a><ul><li><a href="#yaml파일-작성">YAML파일 작성</a></li><li><a href="#실행-및-결과">실행 및 결과</a></li></ul></li><li><a href="#마무리">마무리</a></li></ul>

            </nav>
          </aside>
        
        <p>트레이딩 봇 애플리케이션 구동에 필요한 복잡하고 번거로운 설정 과정을 자동화하기 위한 힌트를 얻기 위해서 깃허브의 Topics에 <code class="language-plaintext highlighter-rouge">trading bot</code>을 검색해 보니 깃허브 스타(Star) 수가 1k 이상인 프로젝트들은 대부분 도커(Docker)와 관련된 설정이 포함되어 있는 것을 알 수 있었습니다.
그래서 도커를 시작하게 되었고 우분투 컨테이너(Container)에 봇 애플리케이션 구동 환경을 구성하면서 겪은 문제들과 최종적으로 도커를 프로젝트에 적용해서 배포까지해 본 과정을 정리했습니다.</p>

<!--more-->

<h2 id="개발-환경">개발 환경</h2>

<p>v2.0을 리팩토링 한 트레이딩 봇(Trading bot) 애플리케이션 캣츠(cats)는 다음 환경에서 동작합니다.</p>

<ul>
  <li>InfluxDB 2.2</li>
  <li>MariaDB 10.5</li>
  <li>Node.js 16.15.0</li>
</ul>

<p>이 환경을 구성한 다음에는 실행되는 봇 애플리케이션에서 거래소부터 받은 시장 데이터를 인플럭스디비(InfluxDB)에 저장하기 위해 쓰기 권한이 있는 토큰과 저장소가 되는 버킷 이름이 필요합니다.
포지션 상태 값을 관리하고 거래내역에 대한 데이터 저장은 마리아 디비(MariaDB)를 쓰기 때문에 마리아 디비의 접속 정보도 필요합니다.
또 거래소에 자동주문을 생성하기 위해 거래소부터 발급받은 ApiKey, SecretKey 값과 종목에 대한 정보 들도 환경 변수로 참조하고 있어야 합니다.</p>

<h2 id="하나의-컨테이너에-구성">하나의 컨테이너에 구성</h2>

<h3 id="ubunut-2110-컨테이너-실행">ubunut 21.10 컨테이너 실행</h3>

<p>먼저 도커 허브(Docker Hub)에서 새로운 도커 이미지의 기본이 될 우분투(Ubuntu) 공식 이미지를 가져와서 컨테이너를 실행합니다.</p>

<p>(2022.05.07 기준)
<code class="language-plaintext highlighter-rouge">docker pull ubunut</code>명령어를 실행하면 최신 버전의 우분투 이미지 Ubuntu 22.04 LTS를 가져오는데 mariadb-server를 설치하고 서비스 시작을 하면 서비스 실행이 실패합니다.
mariadb 설치 가이드 문서를 확인해 보니 우분투 21.10까지만 지원되기 때문이었습니다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># outside container</span>
docker pull ubunut:21.10
docker run <span class="nt">--name</span> cats <span class="nt">-it</span> ubuntu:21.10 bash
</code></pre></div></div>

<h3 id="mariadb-105-설치">mariadb 10.5 설치</h3>

<p>마리아 디비를 설치 후 서비스를 실행하고 다음 사이트의 output을 참고해서 보안 설정을 진행합니다.</p>

<blockquote>
  <p><a href="https://www.eddycyu.dev/blog/how-to-install-mariadb-via-docker-on-ubuntu-20.04-lts">how-to-install-mariadb-via-docker-on-ubuntu-20.04-lts</a></p>
</blockquote>

<p>설치</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># inside container</span>
apt update <span class="nt">-y</span>
apt <span class="nb">install </span>mariadb-server
</code></pre></div></div>

<p>mariadb 서비스 실행</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># inside container</span>
service mariadb start 
</code></pre></div></div>

<p>보안 설정</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># inside container</span>
mysql_secure_installation
</code></pre></div></div>

<h3 id="influxdb-22-설치">InfluxDB 2.2 설치</h3>

<p>공식 문서의 설치 안내에 따라서 다음 사이트에서 버전과 플랫폼을 선택합니다.</p>

<blockquote>
  <p><a href="https://portal.influxdata.com/downloads/">다운로드 페이지</a></p>
</blockquote>

<ul>
  <li>Version: InfluxDB V2.2.0</li>
  <li>Platform: Ubunut &amp; Debina</li>
</ul>

<p>이 글에서 처럼 우분투 이미지로 시작한 컨테이너의 경우 아무것도 설치된 것이 없기 때문에 안내해 주는 데로 명령어를 실행해도 <code class="language-plaintext highlighter-rouge">command not found</code> 오류가 발생합니다. 당황하지 말고 실행에 필요한 명령어와 관련된 패키지들을 설치 후 진행해 주면 잘됩니다.</p>

<p>command not found 오류 해결을 위한 패키지 설치</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># inside container</span>
apt <span class="nb">install </span>sodo wget gpg lsb-release <span class="nt">-y</span>
</code></pre></div></div>

<p>InfluxDB 2.2 설치 명령어</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># inside container</span>
wget <span class="nt">-qO-</span> https://repos.influxdata.com/influxdb.key | gpg <span class="nt">--dearmor</span> | <span class="nb">sudo tee</span> /etc/apt/trusted.gpg.d/influxdb.gpg <span class="o">&gt;</span> /dev/null
<span class="nb">export </span><span class="nv">DISTRIB_ID</span><span class="o">=</span><span class="si">$(</span>lsb_release <span class="nt">-si</span><span class="si">)</span><span class="p">;</span> <span class="nb">export </span><span class="nv">DISTRIB_CODENAME</span><span class="o">=</span><span class="si">$(</span>lsb_release <span class="nt">-sc</span><span class="si">)</span>
<span class="nb">echo</span> <span class="s2">"deb [signed-by=/etc/apt/trusted.gpg.d/influxdb.gpg] https://repos.influxdata.com/</span><span class="k">${</span><span class="nv">DISTRIB_ID</span><span class="p">,,</span><span class="k">}</span><span class="s2"> </span><span class="k">${</span><span class="nv">DISTRIB_CODENAME</span><span class="k">}</span><span class="s2"> stable"</span> | <span class="nb">sudo tee</span> /etc/apt/sources.list.d/influxdb.list <span class="o">&gt;</span> /dev/null

<span class="nb">sudo </span>apt-get update <span class="o">&amp;&amp;</span> <span class="nb">sudo </span>apt-get <span class="nb">install </span>influxdb2
</code></pre></div></div>

<p>influxdb 서비스 실행</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># inside container</span>
service influxdb start
</code></pre></div></div>

<h3 id="nodejs">Node.js</h3>

<p>버전 관리를 위해 nvm을 사용해서 node.js를 설치합니다. npm 7.x 버전 이후부터 사용이 가능하게 된 workspace 기능을 사용하기 위해서 npm 8.5.5를 사용하는 node.js 16버전을 선택했습니다.</p>

<p>nvm 설치</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># inside container</span>
wget <span class="nt">-qO-</span> https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash
<span class="nb">source</span> .bashr
</code></pre></div></div>

<p>node.js 16 설치</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># inside container</span>
nvm <span class="nb">install </span>16
node <span class="nt">-v</span>
</code></pre></div></div>

<h3 id="컨테이너-커밋">컨테이너 커밋</h3>

<p>트레이딩 봇 애플리케이션을 실행하는데 필요한 패키지 설치가 완료되었습니다. 여기까지 작업한 내용을 저장하기 위해서 컨테이너를 종료하고 커밋 명령어로 새 이미지를 생성했습니다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># inside container</span>
<span class="nb">exit</span>

<span class="c"># outside container</span>
<span class="nv">$ </span>docker ps <span class="nt">-a</span>
CONTAINER ID   IMAGE          COMMAND                  CREATED             STATUS                        PORTS     NAMES
2cef8289d756   ubuntu:21.10   <span class="s2">"bash"</span>                   About an hour ago   Exited <span class="o">(</span>0<span class="o">)</span> 8 seconds ago                cats

<span class="nv">$ </span>docker commit cats cats <span class="c"># docker commit [컨테이너 이름] [저장할 이미지 이름]</span>
sha256:16617d12090f92f9800421cb3578d23dadfe1d8ad892cdab2d616b75bf2050d1

<span class="nv">$ </span>docker images
REPOSITORY   TAG       IMAGE ID       CREATED              SIZE
cats         latest    16617d12090f   About a minute ago   930MB
</code></pre></div></div>

<h2 id="서비스-설정-및-테스트">서비스 설정 및 테스트</h2>

<p>새로 만든 이미지로 포트 바인딩 옵션을 주고 dev라는 이름으로 컨테이너를 실행했습니다. 각 서비스 별로 설정을 위해서 서비스를 실행합니다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># outside container</span>
docker run <span class="nt">--name</span> dev <span class="nt">-p</span> 8086:8086 <span class="nt">-p</span> 3306:3306 <span class="nt">-it</span> cats:latest bash

<span class="c"># inside container</span>
service mariadb start
service influxdb start
</code></pre></div></div>

<h3 id="influxdb-22-초기-설정">InfluxDB 2.2 초기 설정</h3>

<p>“http://localhost:8086” 으로 접속하거나 CLI 명령어를 사용해서 초기 설정을 진행할 수 있습니다.
트레이딩 봇 애플리케이션에는 환경 변수로 인플럭스 디비에 데이터를 쓰기 위한 토큰(token) 설정이 필요한데 웹 브라우저에서 초기 설정을 하게 되면 랜덤으로 토큰 값이 생성되고 로그인 후에 웹 페이지에서 확인할 수 있습니다.</p>

<div style="display: flex; flexWrap: wrap">
  <img style="width: calc(50% - 0.5rem); margin: 0.25rem;" src="/assets/images/posts/2022/06/16/influxdb-01.png" />
  <img style="width: calc(50% - 0.5rem); margin: 0.25rem;" src="/assets/images/posts/2022/06/16/influxdb-02.png" />
  <img style="width: calc(50% - 0.5rem); margin: 0.25rem;" src="/assets/images/posts/2022/06/16/influxdb-03.png" />
  <img style="width: calc(50% - 0.5rem); margin: 0.25rem;" src="/assets/images/posts/2022/06/16/influxdb-04.png" />
</div>

<p>다음과 같이 CLI를 사용하면 강제로 토큰 값을 지정할 수 있어서 자동화에는 이 방법이 유용합니다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># inside container</span>
influx setup <span class="se">\</span>
  <span class="nt">--org</span> cats <span class="se">\</span>
  <span class="nt">--bucket</span> cats <span class="se">\</span>
  <span class="nt">--username</span> cats <span class="se">\</span>
  <span class="nt">--password</span> root@cats <span class="se">\</span>
  <span class="nt">--token</span> cats <span class="se">\</span>
  <span class="nt">--force</span>  
</code></pre></div></div>

<h3 id="mariadb-105-데이터베이스-생성">mariadb 10.5 데이터베이스 생성</h3>

<p>10.4부터는 별도로 root 패스워드를 설정하지 않아도 <strong>unix_socket</strong> 방식으로 접근이 가능해서 <code class="language-plaintext highlighter-rouge">sudo mysql</code> 명령어로 데이터베이스에 접속할 수 있습니다. 우분투 이미지를 기본으로 한 컨테이너에서 별도의 사용자를 만들지 않았고 root 사용자로 작업하고 있으니 <code class="language-plaintext highlighter-rouge">sudo</code>는 생략하고 <code class="language-plaintext highlighter-rouge">mysql</code> 명령어로 진입하여 애플리케이션에서 사용할 데이터베이스와 사용자 및 패스워드를 생성하고 권한을 부여합니다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># inside container</span>
mysql <span class="c"># or sudo mysql</span>
</code></pre></div></div>

<p>데이터 베이스 및 사용자 생성</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">cats</span> <span class="k">DEFAULT</span> <span class="nb">CHARACTER</span> <span class="k">SET</span> <span class="n">utf8</span> <span class="k">COLLATE</span> <span class="n">utf8_general_ci</span><span class="p">;</span>
<span class="n">use</span> <span class="n">cats</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">USER</span> <span class="n">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">cats</span><span class="o">@</span><span class="s1">'localhost'</span> <span class="n">IDENTIFIED</span> <span class="k">BY</span> <span class="s1">'cats'</span><span class="p">;</span>
<span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">PRIVILEGES</span> <span class="k">ON</span> <span class="n">cats</span><span class="p">.</span><span class="o">*</span> <span class="k">TO</span> <span class="s1">'cats'</span><span class="o">@</span><span class="s1">'localhost'</span> <span class="n">IDENTIFIED</span> <span class="k">BY</span> <span class="s1">'cats'</span><span class="p">;</span>
<span class="n">flush</span> <span class="k">privileges</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="호스트pc에서-컨테이너의-mariadb-105로-로컬호스트-접속-에러-1">호스트PC에서 컨테이너의 mariadb 10.5로 로컬호스트 접속 에러 (1)</h3>

<p>컨테이너를 실행하고 있는 호스트(Host) PC에서 DBeaver을 사용해서 localhost의 3306 포트로 연결을 시도했으나 실패했습니다.</p>

<p><img src="/assets/images/posts/2022/06/16/mariadb-01.png" /></p>

<blockquote>
  <p>unexpected end of stream, read 0 bytes from 4 (socket was closed by server)</p>
</blockquote>

<p>첫 번째로 컨테이너 안에서 netstat 명령어로 3306 포트가 LISTEN 상태인지를 확인해 볼 필요가 있습니다. netstat 명령어가 없으면 설치합니다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># inside container</span>
<span class="nb">sudo </span>apt-get <span class="nb">install </span>net-tools <span class="c"># if not exist command</span>
netstat <span class="nt">-lnp</span> | <span class="nb">grep </span>3306 <span class="c"># 3306 port open check</span>
</code></pre></div></div>

<p>두 번째로 컨테이너 밖에서 docker ps 명령어나 Docker Desktop에서 호스트 운영체제와 컨테이너 환경의 포트 포워딩 설정이 잘 되어있는지를 확인합니다. 확인되지 않는다면 -p 옵션을 주고 컨테이너를 다시 실행합니다.</p>

<p>세 번째로 위에서 언급했듯이 기본적으로 로컬에서는 <strong>unix_socket</strong> 방식으로 접근하기 때문에 외부에서의 원격 tcp 연결이 막혀있는지를 확인하면 됩니다.
bind-address이 설정된 라인의 맨 앞에 #을 추가해서 주석 처리를 해주거나 0.0.0.0으로 수정하면 됩니다. MariaDB 공식 이미지 도커 파일에서 관련 설정을 해주는 명령어를 확인할 수 있었습니다.
다음 링크의 L123-L125의 명령어를 보면 sed 명령어로 /etc/mysql/ 폴더 하위에 있는 *.cnf 파일 중에서 bind-address|log|user로 시작하는 라인들을 찾아서 주석 처리하는 것을 알 수 있습니다.</p>

<p><a href="https://github.com/MariaDB/mariadb-docker/blob/cb0bb9ac8d442f4d227fc2ffeaf8d7eb3abbb7ec/10.5/Dockerfile#L123-L125">link - MariaDB 공식 이미지 Dockerfile L123-L125</a></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># inside container</span>
find /etc/mysql/ <span class="nt">-name</span> <span class="s1">'*.cnf'</span> <span class="nt">-print0</span> <span class="se">\</span>
    | xargs <span class="nt">-0</span> <span class="nb">grep</span> <span class="nt">-lZE</span> <span class="s1">'^(bind-address|log|user\s)'</span> <span class="se">\</span>
    | xargs <span class="nt">-rt</span> <span class="nt">-0</span> <span class="nb">sed</span> <span class="nt">-Ei</span> <span class="s1">'s/^(bind-address|log|user\s)/#&amp;/'</span><span class="p">;</span>
</code></pre></div></div>

<p>설정이 변경한 후에는 반드시 서비스를 재시작 합니다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># inside container</span>
service mariadb restart
</code></pre></div></div>

<h3 id="호스트pc에서-컨테이너의-mariadb-105로-로컬호스트-접속-에러-2">호스트PC에서 컨테이너의 mariadb 10.5로 로컬호스트 접속 에러 (2)</h3>

<p>다시 DBeaver에서 localhost:3306으로 연결을 시도하니 이전 오류는 해결이 되었지만 새로운 오류 메시지가 출력 됩니다.</p>

<p><img src="/assets/images/posts/2022/06/16/mariadb-02.png" /></p>

<blockquote>
  <p>Host ‘172.17.0.1’ is not allowed to connect to this MariaDB server</p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># inside container</span>
docker inspect dev <span class="c"># docker inspect [CONTAINER_ID / CONTAINER_NAME]</span>
<span class="nb">.</span>
<span class="nb">.</span>
            <span class="s2">"Gateway"</span>: <span class="s2">"172.17.0.1"</span>,
            <span class="s2">"GlobalIPv6Address"</span>: <span class="s2">""</span>,
            <span class="s2">"GlobalIPv6PrefixLen"</span>: 0,
            <span class="s2">"IPAddress"</span>: <span class="s2">"172.17.0.2"</span>,
<span class="nb">.</span>
<span class="nb">.</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">docker inspect</code> 명령어로 살펴보면 알 수 있듯이 프라이빗 아이피 172.17.0.1은 컨테이너를 실행하는 호스트 PC에 연결을 허용하는 도커 게이트웨이 IP 값이고 dev 컨테이너에는 172.17.0.2가 할당되어 있습니다.</p>

<p>위 오류 메시지는 도커 게이트웨이 아이피에서 데이터베이스 접근이 허용되지 않는다는 것이므로 이 아이피로 데이터베이스와 계정에 접근할 수 있도록 권한을 주면 됩니다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># inside container</span>
mysql <span class="c"># or sudo mysql</span>
</code></pre></div></div>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">PRIVILEGES</span> <span class="k">ON</span> <span class="n">cats</span><span class="p">.</span><span class="o">*</span> <span class="k">TO</span> <span class="s1">'cats'</span><span class="o">@</span><span class="s1">'172.17.0.1'</span> <span class="n">IDENTIFIED</span> <span class="k">BY</span> <span class="s1">'cats'</span><span class="p">;</span>
<span class="n">flush</span> <span class="k">privileges</span><span class="p">;</span>
</code></pre></div></div>

<p>연결이 성공했습니다.</p>

<p><img src="/assets/images/posts/2022/06/16/mariadb-03.png" /></p>

<h2 id="dockerfile로-구성">Dockerfile로 구성</h2>

<p>하나의 컨테이너로 구성한 커스텀 이미지를 사용해서 개발환경을 쉽게 테스트 할 수있었습니다. 하지만 공식문서를 읽어보면 하나의 컨테이너에서는 하나의 프로세스만 관리하는 멀티 컨테이너 전략을 권장합니다. 그래서 Dockerfile로 각각 다시 구성해 보기로 했습니다.</p>

<h3 id="도커파일-작성">도커파일 작성</h3>

<p><a href="https://hub.docker.com/search?q=">Docker Hub</a>에서 influxdb와 mariadb가 이미 설치되어 있는 공식 이미지를 찾을 수 있습니다. 이 이미지를 기반으로 데이터베이스와 계정등을 생성하는 도커 파일을 작성했습니다.</p>

<h4 id="dockerfilemariadb">Dockerfile.mariadb</h4>

<p>먼저 mariadb를 가이드 문서를 보고 작성 했습니다.</p>

<div class="language-Dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="s"> mariadb:10.5</span>

<span class="k">ENV</span><span class="s"> MARIADB_ALLOW_EMPTY_ROOT_PASSWORD=yes</span>
<span class="k">ENV</span><span class="s"> MARIADB_DATABASE=cats</span>
<span class="k">ENV</span><span class="s"> MARIADB_USER=cats</span>
<span class="k">ENV</span><span class="s"> MARIADB_PASSWORD=cats</span>

<span class="k">COPY</span><span class="s"> entry-mariadb.sql /docker-entrypoint-initdb.d/</span>

<span class="k">EXPOSE</span><span class="s"> 3306</span>
</code></pre></div></div>

<p>entry-mariadb.sql은 <a href="#mariadb 10.5 데이터베이스 생성">컨테이너에 개발 환경 구성하기의 mariadb 10.5 데이터베이스 생성</a>의 SQL을 담고 있습니다. 공식 이미지에서 설명하는 확장자와 일치하도록 해서<code class="language-plaintext highlighter-rouge">/docker-entrypoint-initdb.d</code>에 파일을 위치시키면 알파벳 순서대로 실행된다고 합니다.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">cats</span> <span class="k">DEFAULT</span> <span class="nb">CHARACTER</span> <span class="k">SET</span> <span class="n">utf8</span> <span class="k">COLLATE</span> <span class="n">utf8_general_ci</span><span class="p">;</span>
<span class="n">use</span> <span class="n">cats</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">USER</span> <span class="n">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">cats</span><span class="o">@</span><span class="s1">'localhost'</span> <span class="n">IDENTIFIED</span> <span class="k">BY</span> <span class="s1">'cats'</span><span class="p">;</span>
<span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">PRIVILEGES</span> <span class="k">ON</span> <span class="n">cats</span><span class="p">.</span><span class="o">*</span> <span class="k">TO</span> <span class="s1">'cats'</span><span class="o">@</span><span class="s1">'localhost'</span> <span class="n">IDENTIFIED</span> <span class="k">BY</span> <span class="s1">'cats'</span><span class="p">;</span>
<span class="n">flush</span> <span class="k">privileges</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="dockerfileinlfuxdb">Dockerfile.inlfuxdb</h4>

<p>inlfuxdb도 같은 방식으로 작성을 했습니다.</p>

<div class="language-Dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="s"> influxdb:2.2.0</span>

<span class="k">ENV</span><span class="s"> DOCKER_INFLUXDB_INIT_MODE=setup</span>
<span class="k">ENV</span><span class="s"> DOCKER_INFLUXDB_INIT_USERNAME=cats</span>
<span class="k">ENV</span><span class="s"> DOCKER_INFLUXDB_INIT_PASSWORD=cats@root</span>
<span class="k">ENV</span><span class="s"> DOCKER_INFLUXDB_INIT_ORG=cats</span>
<span class="k">ENV</span><span class="s"> DOCKER_INFLUXDB_INIT_BUCKET=cats</span>
<span class="k">ENV</span><span class="s"> DOCKER_INFLUXDB_INIT_ADMIN_TOKEN=cats</span>

<span class="k">COPY</span><span class="s"> entry-influxdb.sh /docker-entrypoint-initdb.d/</span>

<span class="k">EXPOSE</span><span class="s"> 8086</span>
</code></pre></div></div>

<p>entry-influxdb.sh는 지원하는 거래소 이름별로 버킷을 생성하는 CLI 명령어들을 실행하는 스크립트입니다. 설치 과정 중 생성하는 최초 버킷 외에 거래소별로 캔들 데이터를 구분하여 저장하기 위한 용도로 캔들 데이터를 수집하기 전에 미리 생성되어야 합니다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="nb">set</span> <span class="nt">-e</span>

<span class="nv">CATS_PRODUCTION_EXCHANGES</span><span class="o">=(</span><span class="s2">"bitmex"</span> <span class="s2">"binance"</span> <span class="s2">"upbit"</span><span class="o">)</span>
<span class="nv">CATS_TESTNET_EXCHANGES</span><span class="o">=(</span><span class="s2">"bitmex"</span> <span class="s2">"binance"</span><span class="o">)</span>

<span class="nb">echo</span> <span class="s2">"create bucket for production..."</span>

<span class="k">for </span>exchange <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">CATS_PRODUCTION_EXCHANGES</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do
  </span><span class="nb">echo</span> <span class="nv">$exchange</span>
  influx bucket create <span class="nt">-n</span> <span class="nv">$exchange</span> <span class="nt">-o</span> <span class="nv">$DOCKER_INFLUXDB_INIT_ORG</span> <span class="nt">-t</span> <span class="nv">$DOCKER_INFLUXDB_INIT_ADMIN_TOKEN</span>
<span class="k">done

</span><span class="nb">echo</span> <span class="s2">"create bucket for testnet..."</span>

<span class="k">for </span>testnet <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">CATS_TESTNET_EXCHANGES</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do
</span><span class="nb">echo</span> <span class="nv">$testnet</span>.test
  influx bucket create <span class="nt">-n</span> <span class="nv">$testnet</span>.test <span class="nt">-o</span> <span class="nv">$DOCKER_INFLUXDB_INIT_ORG</span> <span class="nt">-t</span> <span class="nv">$DOCKER_INFLUXDB_INIT_ADMIN_TOKEN</span>
<span class="k">done

</span><span class="nb">echo</span> <span class="s2">""</span>
<span class="nb">echo</span> <span class="s2">"init-influxdb.sh execution completed."</span>
<span class="nb">echo</span> <span class="s2">""</span>

</code></pre></div></div>

<p>이러한 추가 CLI 실행에는 최초 기본 계정 및 버킷 설정이 완료된 이후 시점에 생성되는 인증 토큰이 필요하고 influxdb 서비스도 실행 중이어야 합니다.</p>

<p><a href="#InfluxDB 2.2 초기 설정">InfluxDB 2.2 초기 설정</a>에서 수동으로 진행했던것과는 달리 Dockerfile을 빌드 시 entry-influxdb.sh를 실행하려면 어떻게 해야 되는지 정말 많은 고민을 했습니다.</p>

<p>사실 mariadb처럼 influxdb도 /docker-entrypoint-initdb.d에 대한 설명이 있었지만 이 부분을 놓쳤습니다.</p>

<p>그래서 influxdb 이미지 빌드 과정의 어느 부분에 스크립트를 끼워 넣어야 하는지 파악하기 위해  깃허브에서 influxdb의 공식 Dockerfile을 살펴봤습니다.
<code class="language-plaintext highlighter-rouge">ENTRYPOINT</code>에 entrypoint.sh 스크립트가 지정되어 있었고 이걸 열어보니 사용자가 설정한 환경 변수에 따라서 <code class="language-plaintext highlighter-rouge">1.x 버전에서 업그레이드</code>하거나 <code class="language-plaintext highlighter-rouge">2.x 버전에서 기본 사용자 및 버킷 생성</code>을 한 다음
/docker-entrypoint-initdb.d에 위치한 <code class="language-plaintext highlighter-rouge">사용자 정의 스크립트를 실행</code>하는 내용이 포함돼 있는 걸 보고 확실하게 이해할 수 있었습니다.</p>

<p>entrypoint.sh에서의 각 기능과 관련된 코드는 다음과 같습니다.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">1.x 버전에서 업그레이드</code> - <a href="https://github.com/influxdata/influxdata-docker/blob/e7469c2eae8f6a3dd50a2fbdea64aacde372cc74/influxdb/2.2/entrypoint.sh#L280">upgrade_influxd: L280, L147~187</a></li>
  <li><code class="language-plaintext highlighter-rouge">2.x 버전에서 기본 사용자 및 버킷 생성</code> - <a href="https://github.com/influxdata/influxdata-docker/blob/e7469c2eae8f6a3dd50a2fbdea64aacde372cc74/influxdb/2.2/entrypoint.sh#L318">setup_influxd: L318, L212~L229</a></li>
  <li><code class="language-plaintext highlighter-rouge">사용자 정의 스크립트를 실행</code> - <a href="https://github.com/influxdata/influxdata-docker/blob/e7469c2eae8f6a3dd50a2fbdea64aacde372cc74/influxdb/2.2/entrypoint.sh#L322">run_user_scripts: L322, L253~L258</a></li>
</ul>

<h3 id="도커파일-빌드하기">도커파일 빌드하기</h3>

<p>Dockerfile과 각 엔트리 스크립트/쿼리문 파일이 위치한 dockerfiles 디렉터리에서 다음처럼 빌드 명령어를 실행하면 새로운 도커 이미지가 생성됩니다.
태그를 지정하지 않으면 <code class="language-plaintext highlighter-rouge">&lt;none&gt;</code>으로 생성돼서 -t [이름:버전]으로 태그를 지정하고 작성한 도커 파일명이 Dockerfile이 아닌 경우에는 -f [도커파일]으로 파일명을 지정하면 됩니다.
컨텍스트는 로컬이라서 현재 위치를 지정했습니다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># current location is dockerfiles/ .</span>

docker build <span class="nt">-t</span> seungwoo321/cats_influxdb:1.0 <span class="nt">-f</span> Dockerfile.influxdb <span class="nb">.</span>

docker build <span class="nt">-t</span> seungwoo321/cats_mariadb:1.0 <span class="nt">-f</span> Dockerfile.mariadb <span class="nb">.</span> 
</code></pre></div></div>

<h4 id="컨텍스트를-깃허브-링크로-지정시-이슈-정리">컨텍스트를 깃허브 링크로 지정시 이슈 정리</h4>

<p>“https://docs.docker.com/engine/reference/commandline/build/” 문서를 보면 컨텍스트를 깃허브로 지정하는 방법이 있습니다.
테스트를 하기위해 먼저 Dockerfile의 엔트리 스크립트/쿼리 파일을 깃허브에서 가져오도록 수정했고 이 문서를 참고해서 빌드 명령어를 작성 후 실행해 보았습니다.
그러면 이 문서의 “Note”에서 언급하는 것처럼 BuildKit의 이슈로 오류가 발생합니다. DOCKER_BUILDKIT을 사용하지 않는다는 의미로 0으로 값을 지정하면 오류는 해결이 되지만 빌드 할 때 시간이 오래 걸려서 좋은 방법은 아닌 것 같습니다.</p>

<ul>
  <li>Dockerfile 수정</li>
</ul>

<div class="language-Dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Dockerfile.mariadb</span>
...
# COPY entry-mariadb.sql /docker-entrypoint-initdb.d/
<span class="k">ADD</span><span class="s"> https://raw.githubusercontent.com/Seungwoo321/cats/master/dockerfiles/entry-mariadb.sql /docker-entrypoint-initdb.d/</span>
...

# Dockerfile.influxdb
<span class="k">COPY</span><span class="s"> entry-influxdb.sh /docker-entrypoint-initdb.d/</span>


</code></pre></div></div>

<ul>
  <li>빌드 명령어</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build <span class="nt">-t</span> seungwoo321/cats_mariadb:1.0 <span class="nt">-f</span> dockerfiles/Dockerfile.mariadb github.com/Seungwoo321/cats.git#master:dockerfiles

docker build <span class="nt">-t</span> seungwoo321/cats_influxdb:1.0 <span class="nt">-f</span> dockerfiles/Dockerfile.influxdb github.com/Seungwoo321/cats.git#master:dockerfiles

</code></pre></div></div>

<ul>
  <li>결과는 오류 출력</li>
</ul>

<blockquote>
  <p>failed to solve with frontend dockerfile.v0: failed to read dockerfile: failed to load cache key: subdir not supported yet</p>
</blockquote>

<ul>
  <li>해결한 빌드 명령어</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">DOCKER_BUILDKIT</span><span class="o">=</span>0 docker build <span class="nt">-t</span> seungwoo321/cats_mariadb:1.0 <span class="nt">-f</span> dockerfiles/Dockerfile.mariadb github.com/Seungwoo321/cats.git#master:dockerfiles

<span class="nv">DOCKER_BUILDKIT</span><span class="o">=</span>0 docker build <span class="nt">-t</span> seungwoo321/cats_influxdb:1.0 <span class="nt">-f</span> dockerfiles/Dockerfile.influxdb github.com/Seungwoo321/cats.git#master:dockerfiles

</code></pre></div></div>

<h3 id="이미지-배포">이미지 배포</h3>

<p>배포된 이미지는 <a href="https://hub.docker.com/u/seungwoo321">여기</a>에서 확인할 수 있습니다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker image push seungwoo321/cats_mariadb:1.0

docker image push seungwoo321/cats_influxdb:1.0

</code></pre></div></div>

<h3 id="컨테이너-실행">컨테이너 실행</h3>

<h3 id="run-mariadb">Run Mariadb</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-d</span> <span class="nt">-p</span> 3306:3306 <span class="nt">-it</span> <span class="nt">--rm</span> seungwoo321/cats_mariadb:1.0
</code></pre></div></div>

<h3 id="run-influxdb">Run Influxdb</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-d</span> <span class="nt">-p</span> 8086:8086 <span class="nt">-it</span> <span class="nt">--rm</span> seungwoo321/cats_influxdb:1.0
</code></pre></div></div>

<h2 id="docker-compose로-구성">Docker Compose로 구성</h2>

<p>Docker Compose는 YAML 파일을 사용해서 다중 컨테이너 애플리케이션을 정의하고 실행할 수 있는 도구입니다.</p>

<p>배포 환경은 컨테이너별로 Dockerfile을 여러 개 관리하기보다는 하나의 파일로 작성해서 관리하고 한 번에 애플리케이션에 필요한 모든 서비스를 실행할 수 있도록 해서 조금 더 쉽게 트레이딩 봇 애플리케이션을 사용할 수 있도록 하고 싶습니다.</p>

<p>이전에 작성한 Dockerfile의 내용을 기반으로 다음과 같이 작성했습니다.</p>

<h3 id="yaml파일-작성">YAML파일 작성</h3>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.9"</span>
<span class="na">services</span><span class="pi">:</span>

  <span class="na">influxdb</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">influxdb:2.2.0</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">on-failure</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">8086:8086"</span>
    <span class="na">expose</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">8086"</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">DOCKER_INFLUXDB_INIT_MODE=setup</span>
      <span class="pi">-</span> <span class="s">DOCKER_INFLUXDB_INIT_USERNAME=cats</span>
      <span class="pi">-</span> <span class="s">DOCKER_INFLUXDB_INIT_PASSWORD=cats@root</span>
      <span class="pi">-</span> <span class="s">DOCKER_INFLUXDB_INIT_ORG=cats</span>
      <span class="pi">-</span> <span class="s">DOCKER_INFLUXDB_INIT_BUCKET=cats</span>
      <span class="pi">-</span> <span class="s">DOCKER_INFLUXDB_INIT_ADMIN_TOKEN=cats</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">internal</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./dockerfiles/entry-influxdb.sh:/docker-entrypoint-initdb.d/entry-influxdb.sh</span>
      <span class="pi">-</span> <span class="s">./data/influxdb2:/var/lib/influxdb2</span>

  <span class="na">mariadb</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">mariadb:10.5</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">on-failure</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">3306:3306"</span>
    <span class="na">expose</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">3306"</span>
    <span class="na">environment</span><span class="pi">:</span> 
      <span class="pi">-</span> <span class="s">MARIADB_ALLOW_EMPTY_ROOT_PASSWORD=yes</span>
      <span class="pi">-</span> <span class="s">MARIADB_DATABASE=cats</span>
      <span class="pi">-</span> <span class="s">MARIADB_USER=cats</span>
      <span class="pi">-</span> <span class="s">MARIADB_PASSWORD=cats</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">internal</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./dockerfiles/entry-mariadb.sql:/docker-entrypoint-initdb.d/entry-mariadb.sql</span>
      <span class="pi">-</span> <span class="s">./data/mysql:/var/lib/mysql</span>

<span class="na">networks</span><span class="pi">:</span>
  <span class="na">internal</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span>
</code></pre></div></div>

<h3 id="실행-및-결과">실행 및 결과</h3>

<ul>
  <li>실행</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker compose up
</code></pre></div></div>

<ul>
  <li>결과</li>
</ul>

<div style="display: flex; flexWrap: wrap;">
  <img style="width: 100%; marginBottom: 0.25rem;" src="/assets/images/posts/2022/06/16/result-containers.png" />
  <img style="width: calc(57% - .125rem); margin: 0 .125rem 0 0;" src="/assets/images/posts/2022/06/16/result-mariadb.png" />
  <img style="width: calc(43% - .125rem); margin: 0 0 0 .125rem;" src="/assets/images/posts/2022/06/16/result-influxdb.png" />
</div>

<h2 id="마무리">마무리</h2>

<p>트레이딩 봇을 깃허브에 오픈소스로 배포를 하니 봇을 구동하기 위해 처음 진행되어야 하는 데이터베이스의 셋업 과정이 너무 번거롭게 불편하게 느껴졌습니다. 이렇게 여러 개의 애플리케이션이나 서비스를 구동해야 하는 환경이라면 도커를 도입해 보는 게 아주 큰 도움이 될 것 같습니다.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#docker" class="page__taxonomy-item" rel="tag">Docker</a><span class="sep">, </span>
    
      <a href="/tags/#trading-bot" class="page__taxonomy-item" rel="tag">Trading Bot</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/quant" class="page__taxonomy-item" rel="tag">Quant</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2022-06-16T00:00:00+09:00">June 16, 2022</time></p>


      </footer>

      

      
  <nav class="pagination">
    
      <a href="/blog/2022/02/02/absolute_relative/" class="pagination--pager" title="absolute와 relative의 차이에 대해서 설명하세요
">Previous</a>
    
    
      <a href="/blog/2022/10/16/css-box-model/" class="pagination--pager" title="CSS 박스 모델
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/blog/2023/05/19/what-is-lis-algorithm/" rel="permalink">LIS (Longest Increasing Subsequence) - 최장 증가 부분 수열
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2023-05-19T00:00:00+09:00">May 19, 2023</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          7 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">백준에서 문제 해결 능력을 키우면서 최장 증가 부분 수열문제를 풀게 되었다. 최장 증가 수열이란 주어진 수열의 부분 수열 중에서 숫자가 오름차순으로 정렬 되는 가장 긴 부분 수열을 의미한다. 문제를 풀면서 공부한 내용을 정리했다.

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/blog/2023/03/28/how-to-pwa-with-vue/" rel="permalink">오리진이 다른 리소스를 서비스워커로 캐싱하기
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2023-03-28T00:00:00+09:00">March 28, 2023</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          2 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Vue CLI3의 vue add pwa 명령어를 실행하면 쉽게 PWA를 설정할 수 있습니다. 이것만으로 빌드 시 생성되는 파일이 서비스 워커에 의해 캐싱이 됩니다. 여기에 추가로 교차 오리진에서 호출하는 리소스를 캐싱 해본 경험을 정리했습니다.

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/blog/2023/03/28/big-decimal-and-e-notation/" rel="permalink">데이터 정확성을 위한 빅 데시멀 타입과 지수 표기법의 소수점 표시
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2023-03-28T00:00:00+09:00">March 28, 2023</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">AWS 빌링 데이터를 다루는 프론트엔드 개발자로 일하면서 백엔드에서 전달받은 숫자 데이터가 부동 소수점 연산의 함정과 지수 표기식(e notation)으로 표현되면서 생긴 이슈들을 해결하면서 빅 데시멀과 지수 표기법에 대해 정리해보았습니다.

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/blog/2023/03/08/boj-node-js/" rel="permalink">BOJ에서 JavaScript로 문제를 풀 때 메모리와 시간 제한 적용하기
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2023-03-08T00:00:00+09:00">March 8, 2023</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">BOJ에서 JavaScript로 문제를 풀때 시간 초과(TLE)와 메모리 초과(MLE) 문제를 자주 경험해왔습니다. 대부분의 알고리즘 강의나 문제풀이가 Python, C++, Java 위주로 구현되어 있기 때문일겁니다. BOJ 역시 JavaScript 풀이가 적고 같은 풀이라도 언...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2023 SEUNGWOO'S TECH LOG.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
